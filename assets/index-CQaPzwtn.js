import{f as g}from"./dateUtil-NBcmMhwL.js";import{k as l,G as v,d as w,f as u,w as b,o as C,j as S,W as T,X as U,Y as O,u as B}from"./vue-Dbi1xauY.js";import{U as N,X as R}from"./antdv-CAXihDg_.js";import{u as A}from"./dynamic-table-DhiAq_hs.js";import{S as j,A as f}from"./index-DWJF4vuV.js";import"./ApiSelect.vue_vue_type_script_setup_true_lang-IWTYr-Fy.js";import"./schema-form.vue_vue_type_script_setup_true_lang-C0d9vjpU.js";import"./is-C0dFuREE.js";import"./index-CCwlABZW.js";const D=[{title:"会话编号",dataIndex:"tokenId",ellipsis:!0,hideInSearch:!0},{title:"用户名",dataIndex:"username",customRender:({record:t})=>l("div",null,[l("span",{class:"pr-4px"},[t.username]),t.isCurrent&&l(N,{color:"processing"},{default:()=>[v("我")]})])},{title:"部门名称",dataIndex:"deptName"},{title:"登录IP",dataIndex:"ip",width:140},{title:"登录地点",dataIndex:"address"},{title:"浏览器",dataIndex:"browser"},{title:"操作系统",dataIndex:"os"},{title:"登录时间",dataIndex:"time",width:180,customRender:({record:t})=>g(t.time)}],W=w({name:"SystemMonitorOnline",__name:"index",setup(t){let d=[];const i=u(!0),r=u([]),c=u(!1),m=j(),[h,k]=A({size:"small"}),I=[...D,{title:"操作",width:80,dataIndex:"ACTION",actions:({record:e})=>[{label:"下线",auth:"system:online:kick",disabled:e.disable,popConfirm:{title:"确定下线该用户吗?",onConfirm:()=>x(e)}}]}],x=async e=>{await f.systemOnline.onlineKick({tokenId:e.tokenId}),k.reload()},_=(...e)=>{[...e]},y=e=>{const a=Object.keys(e);if(!a.some(o=>!!e[o])){n();return}r.value=d.filter(o=>a.every(s=>!e[s]||o[s].includes(e[s])))},n=async()=>{c.value=!0,d=await f.systemOnline.onlineList().finally(()=>c.value=!1),r.value=d},p=()=>{i.value&&n()};return b(i,e=>{e&&n()}),C(()=>{n(),m.emitter.on("onlineUser",p)}),S(()=>{m.emitter.off("onlineUser",p)}),(e,a)=>{const o=R;return T(),U(B(h),{"row-key":"tokenId","header-title":"在线用户","title-tooltip":"这是真实操作，请不要随意将其他用户踢下线。","data-source":r.value,columns:I,loading:c.value,onChange:_,onSearch:y,onReload:n},{toolbar:O(()=>[l(o,{checked:i.value,"onUpdate:checked":a[0]||(a[0]=s=>i.value=s),"checked-children":"开启实时更新","un-checked-children":"关闭实时更新"},null,8,["checked"])]),_:1},8,["data-source","loading"])}}});export{W as default};
